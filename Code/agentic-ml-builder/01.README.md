# Agentic ML Builder

An AI-driven productivity platform for accelerating ML and MLOps development using OpenAI API, RAG, MCP, and Azure AI Foundry.

## Architecture

```
JSON Input → IntegratedMLBuilder → MCP Server
              ↓
    SpecAgent (analyze requirements)
              ↓
    ScaffoldAgent (generate code)
              ↓
    TestAgent (create tests)
              ↓
    ValidatorAgent (validate)
              ↓
    MLOpsAgent (deployment configs)
              ↓
    OrchestrationAgent (Azure Foundry workflow)
              ↓
    Output → OneDrive / Local
```

## Prerequisites

### Required Software
- **Windows 10/11**
- **Python 3.10+** ([Download](https://www.python.org/downloads/))
- **VS Code** ([Download](https://code.visualstudio.com/))
- **PowerShell 7+** ([Download](https://github.com/PowerShell/PowerShell))
- **Azure CLI** ([Download](https://docs.microsoft.com/en-us/cli/azure/install-azure-cli-windows))
- **Docker Desktop for Windows** ([Download](https://www.docker.com/products/docker-desktop))
- **Git** ([Download](https://git-scm.com/download/win))

### Azure Requirements
- Azure subscription with AI Foundry access
- Azure Storage Account
- OneDrive for Business (optional)

## Setup Instructions

### Step 1: Clone and Setup Environment

```powershell
# Clone repository
git clone <your-repo-url>
cd agentic-ml-builder

# Create virtual environment
python -m venv venv

# Activate virtual environment
.\venv\Scripts\Activate.ps1

# Upgrade pip
python -m pip install --upgrade pip

# Install dependencies
pip install -r requirements.txt
```

### Step 2: Configure Environment Variables

Create a `.env` file in the project root:

```env
# OpenAI Configuration
OPENAI_API_KEY=sk-...your_key_here

# Azure OpenAI (Optional - for Azure deployment)
AZURE_OPENAI_ENDPOINT=https://your-resource.openai.azure.com/
AZURE_OPENAI_KEY=your_azure_key
AZURE_OPENAI_DEPLOYMENT=gpt-4o

# Azure Configuration
AZURE_SUBSCRIPTION_ID=your-subscription-id
AZURE_RESOURCE_GROUP=ml-builder-rg
AZURE_LOCATION=eastus
AZURE_AI_PROJECT_NAME=ml-builder-project

# OneDrive Configuration (Optional)
ONEDRIVE_CLIENT_ID=your-client-id
ONEDRIVE_CLIENT_SECRET=your-client-secret
ONEDRIVE_TENANT_ID=your-tenant-id

# MCP Configuration
MCP_SERVER_PORT=8080
```

### Step 3: Initialize RAG System

```powershell
# Create necessary directories
New-Item -ItemType Directory -Force -Path input, output, logs

# Initialize RAG vector store
python src/rag/rag_system.py --init
```

### Step 4: Setup Azure AI Foundry (Optional - for Azure deployment)

```powershell
# Login to Azure
az login

# Set subscription
az account set --subscription "your-subscription-id" # 

# Run Azure setup script
.\deploy\setup_azure.ps1
```

## Usage

### Local Execution

#### Example 1: Scene Dataset (Multi-label Classification)

```powershell
# Create input JSON
$sceneSpec = @"
{
  "project_name": "scene_classifier",
  "purpose": "Multi-label scene classification",
  "data_type": "image",
  "dataset_url": "https://www.openml.org/api/v1/json/data/40595",
  "ml_task": "classification",
  "target_environment": "local",
  "models": ["resnet", "efficientnet"]
}
"@

$sceneSpec | Out-File -FilePath input/scene_dataset.json -Encoding utf8

# Run ML Builder
powershell -ExecutionPolicy Bypass -File run.ps1 --input input/scene_dataset.json --output output
# or this
python src/main.py --input input/scene_dataset.json --output output --validate
```

#### Example 2: Lyrics Dataset (Regression)

```powershell
$lyricsSpec = @"
{
  "project_name": "lyrics_sentiment",
  "purpose": "Lyrics sentiment analysis",
  "data_type": "text",
  "dataset_url": "https://www.openml.org/api/v1/json/data/43597",
  "ml_task": "regression",
  "target_environment": "local",
  "models": ["bert", "lstm"]
}
"@

$lyricsSpec | Out-File -FilePath input/lyrics_dataset.json -Encoding utf8
python src/main.py --input input/lyrics_dataset.json --output output

# easy command (run this)
powershell -ExecutionPolicy Bypass -File run.ps1 --input input/lyrics_dataset.json --output output
```

#### Example 3: Birds Dataset (Classification)

```powershell
$birdsSpec = @"
{
  "project_name": "bird_classifier",
  "purpose": "Bird species classification",
  "data_type": "audio",
  "dataset_url": "https://www.openml.org/api/v1/json/data/40588",
  "ml_task": "classification",
  "target_environment": "azure",
  "models": ["cnn", "transformer"]
}
"@

$birdsSpec | Out-File -FilePath input/birds_dataset.json -Encoding utf8
powershell -ExecutionPolicy Bypass -File run.ps1 --input input/birds_dataset.json --output output
```
```powershell
powershell -ExecutionPolicy Bypass -File run.ps1 --input input/Fashion-MNIST.json --output output
```


### Azure Deployment

```powershell
# Deploy to Azure AI Foundry
.\deploy\deploy_foundry.ps1

# Monitor deployment
az ml job list --resource-group ml-builder-rg --workspace-name ml-builder-workspace
```

## Project Structure

```
agentic-ml-builder/
├── src/
│   ├── main.py                      # Entry point
│   ├── integrated_ml_builder.py     # Main orchestrator
│   ├── agents/
│   │   ├── spec_agent.py           # Specification analyzer
│   │   ├── scaffold_agent.py       # Code generator
│   │   ├── test_agent.py           # Test generator
│   │   ├── validator_agent.py      # Code validator
│   │   ├── mlops_agent.py          # MLOps config generator
│   │   └── orchestration_agent.py  # Azure Foundry orchestrator
│   ├── rag/
│   │   ├── rag_system.py           # RAG implementation
│   │   └── templates/
│   │       └── pytorch_templates.py # ML templates
│   ├── mcp/
│   │   └── mcp_server.py           # MCP server
│   └── utils/
│       ├── onedrive_utils.py       # OneDrive integration
│       ├── azure_utils.py          # Azure utilities
│       └── file_utils.py           # File operations
├── deploy/
│   ├── setup_azure.ps1             # Azure setup
│   └── deploy_foundry.ps1          # Foundry deployment
├── tests/
│   └── test_agents.py              # Unit tests
├── input/                          # Input specifications
├── output/                         # Generated projects
├── requirements.txt
├── config.yaml
├── .env                            # Environment variables
└── README.md
```

## Generated Project Structure

Each generated ML project will have:

```
output/project_name/
├── train.py                # Training script
├── model.py                # Model definition
├── data_loader.py          # Data loading
├── config.py               # Configuration
├── requirements.txt        # Dependencies
├── README.md               # Project documentation
├── tests/
│   ├── test_model.py
│   ├── test_dataloader.py
│   └── test_training.py
├── .github/
│   └── workflows/
│       └── ml_pipeline.yml # CI/CD workflow
└── project_metadata.json   # Generation metadata
```

## Running Tests

```powershell
# Run all tests
pytest tests/ -v

# Run with coverage
pytest tests/ --cov=src --cov-report=html

# Run specific test file
pytest tests/test_agents.py -v
```

## Validation

The system automatically validates generated code:

1. **Syntax Check**: Python syntax validation
2. **Linting**: Code quality with flake8
3. **Unit Tests**: Pytest execution
4. **Docker Validation**: Sandbox container testing

```powershell
# Manual validation
python src/main.py --input input/scene_dataset.json --output output --validate
```

## OpenML Dataset Examples

### 1. Scene Dataset (ID: 40595)
- **Type**: Multi-label image classification
- **Features**: Image features (294 dimensions)
- **Classes**: 6 scene categories
- **Use Case**: Computer vision

### 2. Lyrics Dataset (ID: 43597)
- **Type**: Regression
- **Features**: Text-based lyric features
- **Target**: Spotify valence score
- **Use Case**: NLP sentiment analysis

### 3. Birds Dataset (ID: 40588)
- **Type**: Multi-class classification
- **Features**: Audio features
- **Classes**: Multiple bird species
- **Use Case**: Audio classification

## Troubleshooting

### Issue: OpenAI API Rate Limits
**Solution**: 
```powershell
# Add rate limiting in config.yaml
openai:
  rate_limit: 10  # requests per minute
  retry_delay: 5  # seconds
```

### Issue: Azure Authentication Failed
**Solution**:
```powershell
az logout
az login
az account set --subscription "your-subscription-id"
```

### Issue: Docker Not Running
**Solution**:
1. Start Docker Desktop
2. Wait for Docker to fully initialize
3. Verify: `docker ps`

### Issue: Import Errors
**Solution**:
```powershell
# Reinstall dependencies
pip uninstall -r requirements.txt -y
pip install -r requirements.txt
```

### Issue: OneDrive Connection Failed
**Solution**:
1. Verify client ID and secret in .env
2. Check tenant permissions
3. Run: `az login` for authentication

## Advanced Usage

### Custom Templates

Add custom templates to `src/rag/templates/`:

```python
# custom_template.py
CUSTOM_TEMPLATE = """
# Your custom ML code template
"""
```

### Extend Agents

Create custom agents by extending base classes:

```python
from agents.base_agent import BaseAgent

class CustomAgent(BaseAgent):
    async def process(self, input_data):
        # Your custom logic
        pass
```

## Performance Optimization

### For Large Projects
```powershell
# Use Azure OpenAI for higher rate limits
$env:USE_AZURE_OPENAI="true"

# Enable caching
$env:ENABLE_RAG_CACHE="true"
```

### For Faster Generation
```yaml
# In config.yaml
openai:
  temperature: 0.3  # Lower for more deterministic output
  max_tokens: 2000  # Reduce if possible
```

## Monitoring and Logging

Logs are stored in `logs/` directory:

```powershell
# View logs
Get-Content logs/ml_builder.log -Tail 50

# Monitor in real-time
Get-Content logs/ml_builder.log -Wait
```

## Contributing

1. Fork the repository
2. Create feature branch
3. Make changes
4. Run tests
5. Submit pull request

## Support

For issues:
1. Check troubleshooting section
2. Review logs in `logs/`
3. Run with `--debug` flag
4. Contact support team

## License

MIT License - See LICENSE file for details

## Version History

- **v1.0.0** - Initial release
  - OpenAI API integration
  - RAG system
  - MCP protocol
  - Azure AI Foundry support
  - OpenML dataset support